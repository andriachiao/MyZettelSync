<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>MyZettelSync | Studio å·¥ä½œåŠ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@700&family=Inter:wght@400;900&display=swap');
        body { font-family: 'Inter', sans-serif; background: #f4f4f5; color: #000; height: 100vh; overflow: hidden; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        /* é …ç›®å€å¡Šå‹•ç•« */
        .studio-block { border-left: 4px solid transparent; transition: 0.2s; }
        .studio-block:hover { border-left: 4px solid #000; background: #fff; }
    </style>
</head>
<body class="flex flex-col">

    <header class="h-14 border-b-4 border-black flex items-center justify-between px-6 bg-white z-[100]">
        <div class="flex items-center gap-6">
            <h1 class="text-lg font-900 tracking-tighter uppercase">Zettel Studio</h1>
            <nav class="flex gap-4 text-[10px] font-black uppercase">
                <button onclick="switchView('library')" class="hover:underline">Library</button>
                <button onclick="switchView('studio')" class="hover:underline text-blue-600">Writing Studio</button>
            </nav>
        </div>
        <div id="syncStatus" class="flex gap-2 items-center">
            <button onclick="exportProject()" class="text-[9px] border-2 border-black px-2 py-1 font-black">EXPORT PROJECT</button>
            <div class="w-2 h-2 bg-green-500 rounded-full"></div>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden">
        
        <aside class="w-64 border-r-2 border-zinc-300 flex flex-col bg-white">
            <div class="p-4 border-b-2 border-black">
                <input type="text" placeholder="æœå°‹å¡ç‰‡åŠ å…¥é …ç›®..." class="w-full text-xs outline-none">
            </div>
            <div id="libraryList" class="flex-1 overflow-y-auto no-scrollbar">
                </div>
        </aside>

        <section id="shuttleArea" class="w-1/3 border-r-2 border-zinc-300 bg-zinc-50 overflow-y-auto p-6">
            <div class="mb-6 flex justify-between items-center">
                <h3 class="text-xs font-black uppercase opacity-40">Review & Selection</h3>
                <div class="flex gap-2">
                    <button onclick="loadReview('1w')" class="text-[8px] border border-black px-1">1W</button>
                    <button onclick="loadReview('1m')" class="text-[8px] border border-black px-1">1M</button>
                </div>
            </div>
            <div id="shuttleCards" class="space-y-4">
                </div>
        </section>

        <main class="flex-1 bg-white flex flex-col overflow-hidden">
            <div class="h-12 border-b-2 border-zinc-100 flex items-center px-6 gap-4">
                <select id="projectSelector" onchange="loadProject()" class="text-xs font-black outline-none bg-transparent">
                    <option>2025 æ–°è«–æ–‡é …ç›®</option>
                    <option>æœªå‘½åå°èªª</option>
                </select>
                <button class="text-[18px] font-light">+</button>
            </div>

            <div id="studioCanvas" class="flex-1 overflow-y-auto p-12 no-scrollbar">
                <div class="max-w-xl mx-auto space-y-2" id="projectBlocks">
                    <div class="text-center py-20">
                        <p class="text-zinc-300 font-900 text-xs uppercase tracking-widest">å¾å·¦å´æˆ–ä¸­é–“å°‡å¡ç‰‡<br>å‚³é€åˆ°é€™è£¡é–‹å§‹å‰µä½œ</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

<script>
    // æ•¸æ“šæ¨¡æ“¬
    let cards = JSON.parse(localStorage.getItem('zet_v10')) || [];
    let currentProject = {
        title: "2025 æ–°è«–æ–‡é …ç›®",
        segments: [] // {type: 'card', id: '...'} or {type: 'text', content: '...'}
    };

    window.onload = () => {
        renderLibrary();
        renderStudio();
    };

    function renderLibrary() {
        const list = document.getElementById('libraryList');
        list.innerHTML = cards.map(c => `
            <div class="p-4 border-b border-zinc-100 hover:bg-zinc-50 cursor-pointer group" onclick="addToShuttle('${c.fullId}')">
                <div class="flex justify-between items-center mb-1">
                    <span class="mono text-[9px] font-black">#${c.id}</span>
                    <span class="text-[8px] uppercase opacity-30">${c.mode || ''}</span>
                </div>
                <div class="text-[11px] line-clamp-2 font-bold">${c.content.substring(0,60)}</div>
            </div>
        `).join('');
    }

    function addToShuttle(fid) {
        const c = cards.find(x => x.fullId == fid);
        const container = document.getElementById('shuttleCards');
        const cardHtml = `
            <div class="bg-white border-2 border-black p-4 shadow-[4px_4px_0_0_#000] relative">
                <div class="text-[10px] font-black mb-2">#${c.id}</div>
                <div class="text-xs leading-relaxed mb-4">${marked.parse(c.content)}</div>
                <button onclick="pushToStudio('${c.id}')" class="w-full bg-blue-600 text-white text-[9px] font-black py-1 uppercase hover:bg-black transition">
                    ğŸš€ å‚³é€åˆ°é …ç›® (Push to Studio)
                </button>
            </div>
        `;
        container.innerHTML = cardHtml + container.innerHTML;
    }

    // å‚³é€åˆ°é …ç›®å³å´
    function pushToStudio(id) {
        currentProject.segments.push({ type: 'card', id: id });
        // è‡ªå‹•åœ¨å¡ç‰‡å¾ŒåŠ ä¸€å€‹æ–‡å­—å€å¡Šï¼Œæ–¹ä¾¿å¯«éæ¸¡æ®µ
        currentProject.segments.push({ type: 'text', content: '' });
        renderStudio();
    }

    function renderStudio() {
        const canvas = document.getElementById('projectBlocks');
        if (currentProject.segments.length === 0) return;

        canvas.innerHTML = currentProject.segments.map((seg, idx) => {
            if (seg.type === 'card') {
                const cardData = cards.find(c => c.id === seg.id);
                return `
                    <div class="studio-block p-4 bg-zinc-50 border border-zinc-200 opacity-60 relative group">
                        <span class="absolute -left-8 top-4 text-[8px] font-black opacity-20">REF</span>
                        <div class="text-[10px] font-black border-b border-zinc-200 mb-2 pb-1">[[${cardData.id}]]</div>
                        <div class="text-xs italic">${cardData.content.substring(0,100)}...</div>
                        <button onclick="removeSegment(${idx})" class="absolute right-2 top-2 hidden group-hover:block text-[10px] text-red-500">REMOVE</button>
                    </div>
                `;
            } else {
                return `
                    <div class="studio-block p-4 relative group">
                        <span class="absolute -left-8 top-4 text-[8px] font-black opacity-20 text-blue-600">WRITE</span>
                        <textarea oninput="updateSegment(${idx}, this.value)" 
                            class="w-full min-h-[80px] text-sm leading-relaxed outline-none bg-transparent resize-none placeholder-zinc-200"
                            placeholder="åœ¨é€™è£¡è¼¸å…¥éæ¸¡æ®µè½æˆ–æ–°çš„æƒ³æ³•...">${seg.content}</textarea>
                    </div>
                `;
            }
        }).join('');
    }

    function updateSegment(idx, val) {
        currentProject.segments[idx].content = val;
    }

    function removeSegment(idx) {
        currentProject.segments.splice(idx, 1);
        renderStudio();
    }

    function exportProject() {
        let finalOutput = `# ${currentProject.title}\n\n`;
        currentProject.segments.forEach(seg => {
            if (seg.type === 'card') {
                const c = cards.find(x => x.id === seg.id);
                finalOutput += `\n> ${c.content}\n\n`;
            } else {
                finalOutput += seg.content + "\n";
            }
        });
        const blob = new Blob([finalOutput], {type: 'text/markdown'});
        const a = document.createElement('a');
        a.href = URL.createObjectURL(blob);
        a.download = `${currentProject.title}.md`;
        a.click();
    }

    function switchView(v) {
        // åˆ‡æ›ä»‹é¢é‚è¼¯
        alert("åˆ‡æ›åˆ° " + v + " è¦–åœ–ï¼ˆå·²åœ¨ç•¶å‰ä¸¦è¡Œé¡¯ç¤ºï¼‰");
    }
</script>
</body>
</html>
